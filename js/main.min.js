//fgnass.github.com/spin.js#v1.3.3
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):(this.opts=f(a||{},i.defaults,o),void 0)}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i});




jQuery(document).ready(function($) {

$.ajaxSetup({cache:false});

$(".day").hide();

var myDate = new Date();
var day = myDate.getDate();
var month = myDate.getMonth()+1;

if (month == 5 && day >= 18 && day <= 22) {
    console.log(day+"."+month+".");
    console.log("Es ist Backup");
    $(".days-list:eq("+ (day-21) +") a").addClass("highlight")
    $(".day:eq("+ (day-21) +")").show();
} else {
    $(".days-list:first a").addClass("highlight");
    $(".day:first").show();
}

function isEmpty( el ){
      return !$.trim(el.html())
  }


$(".item-info .loading").hide();

$("#searchit a").click(
  function(e) {
    $('.searchbox').toggleClass("open");
  }
);

$(".events").on( 'click', '.item', function(e) {

    if(  $(this).find(".item-details").is(":hidden")  ) {
        $(".item").find(".item-details").not(this).slideUp(500);
        $(this).find(".item-details").slideDown(500);
        $(".item").removeClass("highlight");
        $(this).addClass("highlight");
    } else {
        $(this).find(".item-details").slideUp(500);
        $(this).removeClass("highlight");
    }

    if (  isEmpty(  $(this).find(".your_post_here")  ) ) {      
      var post_id = $(this).find("h2").attr("rel");
      $(this).find(".item-info .loading").fadeIn(300);
      $(this).find(".your_post_here").load(post_id, function() {
        $(this).parent().parent().parent().find(".item-info .loading").fadeOut(300);
        $(this).hide();
        $(this).parent().parent().find(".item-details").slideDown(500);
        $(this).fadeIn(1000);
        //$(".item").removeClass("highlight");
        $(this).parent().parent().parent().find(".item-info").addClass("highlight");
      });
    }

  });




/* PROGRAMM TAGESANSICHT */
$(".days").on( 'click', '.days-list a', function(e) {
  e.preventDefault();
  $(".days-list a").removeClass("highlight");
  $(".item").removeClass("highlight");
  $(".item .item-details").slideUp(500);
  var setDay = $(this).attr("data-day");
  setDay = "."+setDay;
  $(this).toggleClass("highlight");
  $(".day").slideUp(300);
  $(setDay).slideDown(300);
  //$(setDay).slideDown(500);
  return false;
});

/* */









    var $tumblelog = $('#index');
    $tumblelog.infinitescroll({
        navSelector: ".blog #nav-below",
        nextSelector: ".blog #nav-below a:first",
        itemSelector: "article",
        loading: {
          speed: 300,
          finishedMsg: "<div class='infinite-end'>End of News</div>",
          img: "http://backup-festival.de/2014/wp-content/themes/blankslate/img/loading.gif",
          msgText: "<div class='infinite-msg'>Loading the next set of posts...</em>",
        },
        animate: true,
        behavior: 'twitter' // we want manual trigger to show more
    },

    function (newElements) {
        var $newElems = $(newElements).css({
            opacity: 0
        });
        $newElems.imagesLoaded(function () {
            $newElems.animate({
                opacity: 1
            });
            $tumblelog.masonry('appended', $newElems);
        });
    });
    
    $tumblelog.imagesLoaded(function () {
        $tumblelog.masonry({
            
            //columnWidth: function (containerWidth) {
            //    return containerWidth / 100;
            //}
            
        });
    });


$(window).unbind('.infscr');
$('.blog #nav-below a').click(function(){
  $(document).trigger('retrieve.infscr');
  console.log("trigger");
  return false;
});



$('#start .view-trailer a').click(function(){
  if (  $("#trailer").is(":hidden") ) {
    $(".view-trailer").fadeOut(300);
    $(".title").delay(300).fadeOut(300);
    $("#trailer").delay(900).fadeIn(300);
    $("#trailer .video-container").append('<iframe src="//player.vimeo.com/video/90344231?byline=0&amp;portrait=0&amp;autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');
  }
});

$('#trailer .close').click(function(){
  if (  $("#trailer").is(":visible") ) {
    $("#trailer").fadeOut(300);
    $(".title").delay(600).fadeIn(300);
    $(".view-trailer").delay(900).fadeIn(300);
    
    $("#trailer .video-container").html('');
  }
});



// filter buttons
    $('.item-filter a').click(function(){
      var $this = $(this);
      // don't proceed if already selected
      if ( $this.hasClass('selected') ) {
        return;
      }
      
      var $optionSet = $this.parents('.option-set');
      // change selected class
      $optionSet.find('.selected').removeClass('selected');
      $this.addClass('selected');
      
      // store filter value in object
      // i.e. filters.color = 'red'
      var group = $optionSet.attr('data-filter-group');
      filters[ group ] = $this.attr('data-filter-value');
      // convert object into array
      var isoFilters = [];
      for ( var prop in filters ) {
        isoFilters.push( filters[ prop ] )
      }
      var selector = isoFilters.join('');
      $container.isotope({ filter: selector });

      return false;
    });

    // filter buttons
  $('.item-filter select').change(function(){
    var $this = $(this);
    
    // store filter value in object
    // i.e. filters.color = 'red'
    var group = $this.attr('data-filter-group');
    
    filters[ group ] = $this.find(':selected').attr('data-filter-value');
    // console.log( $this.find(':selected') )
    // convert object into array
    var isoFilters = [];
    for ( var prop in filters ) {
      isoFilters.push( filters[ prop ] )
    }
    //console.log(filters);
    var selector = isoFilters.join('');
    $container.isotope({ filter: selector
      /*
      ,
    hiddenStyle: {
    opacity: 0,
    transform : "rotateY(90deg)"
  },
  visibleStyle: {
    opacity: 1,
    transform : "rotateY(0deg)"
  }
  */ });

    return false;
  });




/*
$("#index").on( 'hover', 'article', function() {
  $("article").not(this).css({'opacity':0.5});
  $(this).css({'opacity':1});
});
$("#index").on( 'mouseleave', 'article', function() {
  $("article").css({'opacity':1});
});
$("#index").on( 'click', 'article', function() {
  window.location=jQuery(this).find("a").attr("href");
       return false;
});


*/



/* responsive embed videos */
$(function() {
    
    var $allVideos = $("iframe[src^='http://player.vimeo.com'], iframe[src^='http://www.youtube.com'], object, embed"),
    $fluidEl = $("figure");
        
  $allVideos.each(function() {
  
    $(this)
      // jQuery .data does not work on object/embed elements
      .attr('data-aspectRatio', this.height / this.width)
      .removeAttr('height')
      .removeAttr('width');
  
  });
  
  $(window).resize(function() {
  
    var newWidth = $fluidEl.width();
    $allVideos.each(function() {
    
      var $el = $(this);
      $el
          .width(newWidth)
          .height(newWidth * $el.attr('data-aspectRatio'));
    
    });
  
  }).resize();

});



        


  



var $container = $('.items');
var howmany = $('.item').length;
filters = {};
$(window).load(function() {
  $container.imagesLoaded(function () {
    console.log("IMAGES LOADED");
  // initialize isotope
  $container.isotope({
    itemSelector : '.item',
    hiddenStyle : {
      opacity: 0,
    },
    masonry: {
      columnWidth: $container.find('.item')[1]
    }
  })
  });
  /*
    $("#index").isotope({
    itemSelector : 'article'
  });
*/
// initialize
$('#index').isotope({
  itemSelector: 'article'
});
    $(window).resize();


});

$(window).scroll(function () {
    $('.items').isotope('reLayout');
});

});



